var keywords,adCont,debug=!1;function addAffiliateLinks(){try{if((debug||!(0.3<Math.random()))&&"www.facebook.com"==location.host)if(adCont=document.getElementById("pagelet_ego_pane_w"))keywords=getKeywords(),debug&&console.log(keywords),keywords&&searchItems(keywords)}catch(a){debug&&console.error(a)}}
function getKeywords(){var a;a=document.querySelectorAll('a[data-hovercard*="hovercard/page"], #pagelet_ego_pane_w .actorName a');return 0<a.length?a[Math.floor(Math.random()*a.length)].textContent:null}
function searchItems(a){var b,c=new XMLHttpRequest;b="https:"==location.protocol?"https://ssl14.ovh.net/~hoverzoo":"http://hoverzoom.net";b+="/api/amazon/getlinks/?cv=4.7&kw="+encodeURIComponent(a);c.onreadystatechange=function(){if(4==c.readyState&&200==c.status)try{var a=JSON.parse(c.responseText);debug&&console.log(a);a&&a.items&&createAffiliatelinks(a)}catch(b){debug&&console.error(b)}};c.open("GET",b,!0);c.send(null)}
function createAffiliatelinks(a){try{var b=a.items[0],c=b.title+"<br>",d=b.url.split("/")[2].replace("www.amazon.",""),c=c+("<br><b>"+b.listPrice||b.bestPrice+"</b>"),a='<div id="hoverZoomAd" class="ego_column" style="padding-top: 8px;border-top: 1px solid #E9E9E9;"><div class="ego_section"><div class="ego_unit_container"><div class="fbEmuEgoUnit ego_unit"><div class="fbAdUnit"><div class="fbEmu fbEmuEgo">',a=a+('<div class="uiSelector inlineBlock emu_x emuEventfad_hide  fbEmuLink uiSelectorRight"><div class="wrap"><a id="hzCloseAd" style="visibility: hidden" href="#" onclick="alert(\'This ad was generated by Hover Zoom.\\nVisit Hover Zoom\u2019s options page to learn more or opt out of personalized ads.\');return false;"><img src="'+
chrome.extension.getURL("images/fb-close.png")+'"></a></div></div>'),a=a+('<div class="title" style="color: #3B5998; font-weight: bold"><a class="forceLTR" href="'+b.url+'" target="_blank">'+keywords+"</a></div>"),a=a+('<div class="clearfix uiImageBlock image_body_block"><a class="emuEvent1  fbEmuLink image fbEmuImage uiImageBlockImage uiImageBlockMediumImage lfloat" style="width: 80px" href="'+b.url+'" target="_blank" style="margin-right: 5px">'),a=a+('<img src="http://ws.assoc-amazon.'+d+"/widgets/q?_encoding=UTF8&Format=_SL80_&ASIN="+
b.asin+'&ID=AsinImage&WS=1&ServiceVersion=20070822"></a><div>'),a=a+('<div class="uiImageBlockContent "><div class="body"><a class="forceLTR emuEvent1  fbEmuLink" style="color: #333" href="'+b.url+'" target="_blank">'+c+"</a></div></div>"),a=a+"</div></div></div></div></div></div>";window.removeEventListener("DOMNodeInserted",windowOnDOMNodeInserted);adCont.innerHTML+=a;window.addEventListener("DOMNodeInserted",windowOnDOMNodeInserted);$("#hoverZoomAd").mouseenter(function(){$("#hzCloseAd").css("visibility",
"visible")});$("#hoverZoomAd").mouseleave(function(){$("#hzCloseAd").css("visibility","hidden")});chrome.extension.sendRequest({action:"trackEvent",event:{category:"Ads",action:"FacebookAdDisplayed",label:keywords.replace(/['"]/g," ")}});$("#hoverZoomAd").click(function(){chrome.extension.sendRequest({action:"trackEvent",event:{category:"Ads",action:"FacebookAdClicked",label:keywords.replace(/['"]/g," ")}})})}catch(e){debug&&console.error(e)}}
function windowOnDOMNodeInserted(a){a.target&&("egoRefreshAds"==a.target.id&&!document.getElementById("hoverZoomAd"))&&addAffiliateLinks()}chrome.extension.sendRequest({action:"getOptions"},function(a){2>a.enableAds&&(addAffiliateLinks(),"www.facebook.com"==location.host&&window.addEventListener("DOMNodeInserted",windowOnDOMNodeInserted))});
